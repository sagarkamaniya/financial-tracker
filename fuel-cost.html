<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuel Cost - Financial Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
    <div class="w-full max-w-md sm:max-w-lg bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold text-center text-purple-600 mb-6">Fuel Cost</h1>
      <nav class="flex flex-col sm:flex-row gap-2 mb-4">
    <a href="index.html" class="flex-1 p-2 text-center bg-gray-500 text-white rounded hover:bg-gray-600">Home</a>
    <a href="income.html" class="flex-1 p-2 text-center bg-emerald-500 text-white rounded hover:bg-emerald-600">Income</a>
    <a href="expenses.html" class="flex-1 p-2 text-center bg-blue-600 text-white rounded hover:bg-blue-700">Expenses</a>
    <a href="fuel-cost.html" class="flex-1 p-2 text-center bg-purple-600 text-white rounded hover:bg-purple-700">Fuel Cost</a>
    <a href="investments.html" class="flex-1 p-2 text-center bg-teal-600 text-white rounded hover:bg-teal-700">Investments</a>
    <a href="net-worth.html" class="flex-1 p-2 text-center bg-indigo-600 text-white rounded hover:bg-indigo-700">Net Worth</a>
    <a href="statements.html" class="flex-1 p-2 text-center bg-amber-600 text-white rounded hover:bg-amber-700">Statements</a>
    <a href="loans-lending.html" class="flex-1 p-2 text-center bg-rose-600 text-white rounded hover:bg-rose-700">Loans & Lending</a>
</nav>
        <div class="mb-6">
            <input type="number" id="odometerReading" placeholder="Odometer Reading (km)" class="w-full p-2 mb-2 border rounded focus:outline-none focus:ring-2 focus:ring-purple-500">
            <input type="number" id="totalFuelCost" placeholder="Total Fuel Cost (₹)" class="w-full p-2 mb-2 border rounded focus:outline-none focus:ring-2 focus:ring-purple-500">
            <input type="number" id="dieselPrice" placeholder="Diesel Price (₹/liter)" class="w-full p-2 mb-2 border rounded focus:outline-none focus:ring-2 focus:ring-purple-500">
            <button onclick="addFuelCost()" class="w-full bg-purple-600 text-white p-2 rounded hover:bg-purple-700">Add Fuel Cost</button>
        </div>
        <div id="mileageList" class="mb-4"></div>
        <div class="text-lg font-semibold text-purple-600">Total Fuel Cost: ₹<span id="totalFuelCost">0.00</span></div>
        <div class="text-lg font-semibold text-purple-600">Average Fuel Efficiency: <span id="avgFuelEfficiency">N/A</span> km/L</div>
    </div>

    <script defer>
        let mileages = JSON.parse(localStorage.getItem('mileages')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];

        function addFuelCost() {
            try {
                const odometerReading = parseFloat(document.getElementById('odometerReading').value);
                const totalFuelCost = parseFloat(document.getElementById('totalFuelCost').value);
                const dieselPrice = parseFloat(document.getElementById('dieselPrice').value);
                if (!isNaN(odometerReading) && odometerReading >= 0 && !isNaN(totalFuelCost) && totalFuelCost >= 0 && !isNaN(dieselPrice) && dieselPrice > 0) {
                    const timestamp = new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
                    const fuelVolume = totalFuelCost / dieselPrice;
                    let kilometersDriven = 0;
                    let fuelEfficiency = 0;
                    if (mileages.length > 0) {
                        const previousOdometerReading = mileages[mileages.length - 1].odometerReading;
                        kilometersDriven = odometerReading - previousOdometerReading;
                        fuelEfficiency = fuelVolume > 0 && kilometersDriven >= 0 ? (kilometersDriven / fuelVolume) : 0;
                    }
                    mileages.push({ id: Date.now(), timestamp, odometerReading, kilometersDriven, totalFuelCost, dieselPrice, fuelVolume, fuelEfficiency });
                    expenses.push({ id: Date.now() + 1, description: `Fuel Cost on ${timestamp}`, amount: totalFuelCost, category: 'Transport', timestamp });
                    localStorage.setItem('mileages', JSON.stringify(mileages));
                    localStorage.setItem('expenses', JSON.stringify(expenses));
                    document.getElementById('odometerReading').value = '';
                    document.getElementById('totalFuelCost').value = '';
                    document.getElementById('dieselPrice').value = '';
                    renderMileages();
                } else {
                    alert('Please enter valid values for odometer reading, total fuel cost, and diesel price (diesel price must be greater than 0).');
                }
            } catch (e) {
                console.error('Error in addFuelCost:', e);
                alert('An error occurred while adding fuel cost. Please try again.');
            }
        }

        function deleteMileage(id) {
            try {
                mileages = mileages.filter(item => item.id !== id);
                for (let i = 1; i < mileages.length; i++) {
                    mileages[i].kilometersDriven = mileages[i].odometerReading - mileages[i - 1].odometerReading;
                    mileages[i].fuelEfficiency = mileages[i].fuelVolume > 0 && mileages[i].kilometersDriven >= 0 ? (mileages[i].kilometersDriven / mileages[i].fuelVolume) : 0;
                }
                if (mileages.length > 0) {
                    mileages[0].kilometersDriven = 0;
                    mileages[0].fuelEfficiency = 0;
                }
                localStorage.setItem('mileages', JSON.stringify(mileages));
                renderMileages();
            } catch (e) {
                console.error('Error in deleteMileage:', e);
                alert('An error occurred while deleting fuel cost. Please try again.');
            }
        }

        function renderMileages() {
            try {
                const mileageList = document.getElementById('mileageList');
                mileageList.innerHTML = '';
                let totalFuelCost = 0;
                let totalKilometers = 0;
                let totalFuelVolume = 0;
                mileages.forEach((mileage, index) => {
                    totalFuelCost += mileage.totalFuelCost;
                    if (index > 0) {
                        totalKilometers += mileage.kilometersDriven;
                        totalFuelVolume += mileage.fuelVolume;
                    }
                    const fuelEfficiencyDisplay = mileage.fuelEfficiency > 0 ? mileage.fuelEfficiency.toFixed(2) : 'N/A';
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 border-b border-purple-200';
                    div.innerHTML = `
                        <div>
                            <span class="font-medium text-purple-700">${mileage.timestamp}</span> 
                            <span class="text-sm text-gray-500">(Odometer: ${mileage.odometerReading} km, ${mileage.kilometersDriven} km driven, ${mileage.fuelVolume.toFixed(2)} L @ ₹${mileage.dieselPrice}/L, Efficiency: ${fuelEfficiencyDisplay} km/L)</span>
                        </div>
                        <div>
                            <span class="text-purple-600">₹${mileage.totalFuelCost.toFixed(2)}</span>
                            <button onclick="deleteMileage(${mileage.id})" class="ml-2 text-red-500 hover:text-red-700">Delete</button>
                        </div>
                    `;
                    mileageList.appendChild(div);
                });
                document.getElementById('totalFuelCost').textContent = totalFuelCost.toFixed(2);
                const avgFuelEfficiency = totalFuelVolume > 0 && mileages.length > 1 ? (totalKilometers / totalFuelVolume).toFixed(2) : 'N/A';
                document.getElementById('avgFuelEfficiency').textContent = avgFuelEfficiency;
            } catch (e) {
                console.error('Error in renderMileages:', e);
                alert('An error occurred while rendering fuel costs. Please try again.');
            }
        }

        try {
            renderMileages();
        } catch (e) {
            console.error('Error during initial render:', e);
            alert('An error occurred while loading the page. Please refresh.');
        }
    </script>
</body>
</html>