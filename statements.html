<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statements</title>
    <link href="styles.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">
    <nav class="bg-white shadow p-4">
        <ul class="flex space-x-4 justify-center">
            <li><a href="index.html" class="text-blue-500 hover:text-blue-700">Home</a></li>
            <li><a href="income.html" class="text-blue-500 hover:text-blue-700">Income</a></li>
            <li><a href="expenses.html" class="text-blue-500 hover:text-blue-700">Expenses</a></li>
            <li><a href="fuel-cost.html" class="text-blue-500 hover:text-blue-700">Fuel Cost</a></li>
            <li><a href="investments.html" class="text-blue-500 hover:text-blue-700">Investments</a></li>
            <li><a href="net-worth.html" class="text-blue-500 hover:text-blue-700">Net Worth</a></li>
            <li><a href="statements.html" class="text-blue-700 font-bold">Statements</a></li>
            <li><a href="loans-lending.html" class="text-blue-500 hover:text-blue-700">Loans & Lending</a></li>
            <li><a href="settings.html" class="text-blue-500 hover:text-blue-700">Settings</a></li>
        </ul>
    </nav>

    <div class="container mx-auto p-4 max-w-4xl">
        <h1 class="text-2xl font-bold text-center mb-6">Statements</h1>

        <div class="bg-white shadow rounded-lg p-6">
            <form id="statementForm" class="space-y-4">
                <div>
                    <select id="statement-type" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All</option>
                        <option value="income">Income</option>
                        <option value="expenses">Expenses</option>
                        <option value="fuel">Fuel Cost</option>
                        <option value="investments">Investments</option>
                        <option value="loans">Loans & Lending</option>
                    </select>
                </div>
                <div>
                    <input type="date" id="start-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="date" id="end-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Generate Statement</button>
            </form>
        </div>

        <div id="statementSummary" class="bg-white shadow rounded-lg p-6 mt-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Statement Summary</h2>
            <div id="summaryData" class="space-y-2">
                <p id="totalIncome" class="text-gray-600">Total Income: ₹0.00</p>
                <p id="totalExpenses" class="text-gray-600">Total Expenses: ₹0.00</p>
                <p id="totalFuel" class="text-gray-600">Total Fuel Cost: ₹0.00</p>
                <p id="totalInvestments" class="text-gray-600">Total Investments: ₹0.00</p>
                <p id="totalLoans" class="text-gray-600">Total Loans (Net): ₹0.00</p>
                <p id="netWorth" class="text-gray-600 font-bold">Net Worth Change: ₹0.00</p>
            </div>
            <div class="mt-4 space-y-2">
                <button id="downloadPdf" class="w-full bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Download as PDF</button>
                <button id="downloadExcel" class="w-full bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Download as Excel</button>
            </div>
        </div>
    </div>

    <script>
        // Simulate data from other pages (replace with actual data storage in production)
        const mockData = {
            income: [
                { date: '2025-09-01', amount: 50000, category: 'Salary' },
                { date: '2025-09-05', amount: 10000, category: 'Freelance' },
                { date: '2025-09-10', amount: 2000, category: 'Other' }
            ],
            expenses: [
                { date: '2025-09-02', amount: 5000, category: 'Food' },
                { date: '2025-09-07', amount: 2000, category: 'Transport' },
                { date: '2025-09-12', amount: 1000, category: 'Bills' }
            ],
            fuelCost: [
                { date: '2025-09-03', amount: 1500, category: 'Fuel' },
                { date: '2025-09-08', amount: 1200, category: 'Fuel' }
            ],
            investments: [
                { date: '2025-09-04', amount: 10000, category: 'Stocks' },
                { date: '2025-09-11', amount: 5000, category: 'Crypto' }
            ],
            loans: [
                { date: '2025-09-06', amount: 20000, category: 'Borrowed' },
                { date: '2025-09-13', amount: -3000, category: 'Repayment' },
                { date: '2025-09-09', amount: 5000, category: 'Lent' },
                { date: '2025-09-14', amount: -1000, category: 'Repayment Received' }
            ]
        };

        // Calculate totals for a given date range and statement type
        function calculateTotals(startDate, endDate, statementType) {
            const filteredData = {};
            let totalIncome = 0, totalExpenses = 0, totalFuel = 0, totalInvestments = 0, totalLoans = 0;

            const categories = statementType === 'all' ? ['income', 'expenses', 'fuelCost', 'investments', 'loans'] : 
                              statementType === 'loans' ? ['loans'] : [statementType];

            categories.forEach(key => {
                filteredData[key] = mockData[key]?.filter(item => {
                    const itemDate = new Date(item.date);
                    return itemDate >= new Date(startDate) && itemDate <= new Date(endDate);
                }) || [];

                filteredData[key].forEach(item => {
                    const amount = parseFloat(item.amount);
                    if (key === 'income') totalIncome += amount;
                    if (key === 'expenses') totalExpenses += amount;
                    if (key === 'fuelCost') totalFuel += amount;
                    if (key === 'investments') totalInvestments += amount;
                    if (key === 'loans') totalLoans += amount;
                });
            });

            return {
                filteredData,
                totals: {
                    income: totalIncome,
                    expenses: totalExpenses,
                    fuel: totalFuel,
                    investments: totalInvestments,
                    loans: totalLoans,
                    netWorth: totalIncome - totalExpenses - totalFuel + totalInvestments + totalLoans
                }
            };
        }

        // Display summary
        function displaySummary(startDate, endDate, statementType, data) {
            const { totals } = data;
            document.getElementById('totalIncome').textContent = `Total Income: ₹${totals.income.toLocaleString('en-IN')}`;
            document.getElementById('totalExpenses').textContent = `Total Expenses: ₹${totals.expenses.toLocaleString('en-IN')}`;
            document.getElementById('totalFuel').textContent = `Total Fuel Cost: ₹${totals.fuel.toLocaleString('en-IN')}`;
            document.getElementById('totalInvestments').textContent = `Total Investments: ₹${totals.investments.toLocaleString('en-IN')}`;
            document.getElementById('totalLoans').textContent = `Total Loans (Net): ₹${totals.loans.toLocaleString('en-IN')}`;
            document.getElementById('netWorth').textContent = `Net Worth Change: ₹${totals.netWorth.toLocaleString('en-IN')}`;

            // Hide irrelevant totals based on statement type
            document.getElementById('totalIncome').style.display = statementType === 'all' || statementType === 'income' ? 'block' : 'none';
            document.getElementById('totalExpenses').style.display = statementType === 'all' || statementType === 'expenses' ? 'block' : 'none';
            document.getElementById('totalFuel').style.display = statementType === 'all' || statementType === 'fuel' ? 'block' : 'none';
            document.getElementById('totalInvestments').style.display = statementType === 'all' || statementType === 'investments' ? 'block' : 'none';
            document.getElementById('totalLoans').style.display = statementType === 'all' || statementType === 'loans' ? 'block' : 'none';
            document.getElementById('netWorth').style.display = statementType === 'all' ? 'block' : 'none';
        }

        // Download as PDF
        document.getElementById('downloadPdf').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const statementType = document.getElementById('statement-type').value;
            const data = calculateTotals(startDate, endDate, statementType);

            doc.setFontSize(16);
            doc.text(`Financial Statement: ${startDate} to ${endDate}`, 20, 20);
            doc.setFontSize(12);
            let y = 40;
            if (statementType === 'all' || statementType === 'income') {
                doc.text(`Total Income: ₹${data.totals.income.toLocaleString('en-IN')}`, 20, y);
                y += 10;
            }
            if (statementType === 'all' || statementType === 'expenses') {
                doc.text(`Total Expenses: ₹${data.totals.expenses.toLocaleString('en-IN')}`, 20, y);
                y += 10;
            }
            if (statementType === 'all' || statementType === 'fuel') {
                doc.text(`Total Fuel Cost: ₹${data.totals.fuel.toLocaleString('en-IN')}`, 20, y);
                y += 10;
            }
            if (statementType === 'all' || statementType === 'investments') {
                doc.text(`Total Investments: ₹${data.totals.investments.toLocaleString('en-IN')}`, 20, y);
                y += 10;
            }
            if (statementType === 'all' || statementType === 'loans') {
                doc.text(`Total Loans (Net): ₹${data.totals.loans.toLocaleString('en-IN')}`, 20, y);
                y += 10;
            }
            if (statementType === 'all') {
                doc.text(`Net Worth Change: ₹${data.totals.netWorth.toLocaleString('en-IN')}`, 20, y);
            }

            doc.save(`statement_${statementType}_${startDate}_to_${endDate}.pdf`);
        });

        // Download as Excel
        document.getElementById('downloadExcel').addEventListener('click', function() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const statementType = document.getElementById('statement-type').value;
            const data = calculateTotals(startDate, endDate, statementType);
            const { filteredData, totals } = data;

            const wb = XLSX.utils.book_new();
            const wsData = [['Category', 'Total Amount']];
            if (statementType === 'all' || statementType === 'income') wsData.push(['Income', totals.income]);
            if (statementType === 'all' || statementType === 'expenses') wsData.push(['Expenses', totals.expenses]);
            if (statementType === 'all' || statementType === 'fuel') wsData.push(['Fuel Cost', totals.fuel]);
            if (statementType === 'all' || statementType === 'investments') wsData.push(['Investments', totals.investments]);
            if (statementType === 'all' || statementType === 'loans') wsData.push(['Loans (Net)', totals.loans]);
            if (statementType === 'all') wsData.push(['Net Worth Change', totals.netWorth]);

            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Summary');

            // Add detailed sheets
            const categories = statementType === 'all' ? ['income', 'expenses', 'fuelCost', 'investments', 'loans'] : 
                              statementType === 'loans' ? ['loans'] : [statementType];
            categories.forEach(key => {
                if (filteredData[key]?.length > 0) {
                    const detailData = [['Date', 'Amount', 'Category'], ...filteredData[key].map(item => [item.date, item.amount, item.category])];
                    const detailWs = XLSX.utils.aoa_to_sheet(detailData);
                    XLSX.utils.book_append_sheet(wb, detailWs, key.charAt(0).toUpperCase() + key.slice(1));
                }
            });

            XLSX.writeFile(wb, `statement_${statementType}_${startDate}_to_${endDate}.xlsx`);
        });

        // Form submission
        document.getElementById('statementForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const statementType = document.getElementById('statement-type').value;
            if (!startDate || !endDate) {
                alert('Please select a date range.');
                return;
            }
            const data = calculateTotals(startDate, endDate, statementType);
            displaySummary(startDate, endDate, statementType, data);
            document.getElementById('statementSummary').classList.remove('hidden');
        });
    </script>
</body>
</html>